---
phase: 05-config-toggle
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/main/java/world/bentobox/islandselector/Settings.java
  - src/main/java/world/bentobox/islandselector/commands/SlotsCommand.java
  - src/main/java/world/bentobox/islandselector/gui/MainGridGUI.java
  - src/main/java/world/bentobox/islandselector/gui/SharedGridGUIListener.java
autonomous: true

must_haves:
  truths:
    - "Config file contains slots.enabled option with default true"
    - "When slots.enabled is false, /islandselector slots shows disabled message"
    - "When slots.enabled is false, slots button does not appear in main GUI"
    - "When slots.enabled is true, slot functionality works unchanged"
  artifacts:
    - path: "src/main/java/world/bentobox/islandselector/Settings.java"
      provides: "slotsEnabled config field with getter/setter"
      contains: "isSlotsEnabled"
    - path: "src/main/java/world/bentobox/islandselector/commands/SlotsCommand.java"
      provides: "Config check before FAWE check"
      contains: "isSlotsEnabled"
    - path: "src/main/java/world/bentobox/islandselector/gui/MainGridGUI.java"
      provides: "Conditional slot button rendering"
      contains: "isSlotsEnabled"
    - path: "src/main/java/world/bentobox/islandselector/gui/SharedGridGUIListener.java"
      provides: "Conditional slot click handling"
      contains: "isSlotsEnabled"
  key_links:
    - from: "SlotsCommand.java"
      to: "Settings.isSlotsEnabled()"
      via: "addon.getSettings().isSlotsEnabled()"
      pattern: "getSettings\\(\\)\\.isSlotsEnabled\\(\\)"
    - from: "MainGridGUI.java"
      to: "Settings.isSlotsEnabled()"
      via: "addon.getSettings().isSlotsEnabled()"
      pattern: "getSettings\\(\\)\\.isSlotsEnabled\\(\\)"
    - from: "SharedGridGUIListener.java"
      to: "Settings.isSlotsEnabled()"
      via: "gui.getAddon().getSettings().isSlotsEnabled()"
      pattern: "getSettings\\(\\)\\.isSlotsEnabled\\(\\)"
---

<objective>
Add configuration option to enable/disable the slot system entirely.

Purpose: Allow server admins to disable the multi-slot island system if they do not need it, reducing complexity for simpler server configurations.

Output: Working `slots.enabled` config toggle that:
- Shows/hides the slots button in the main GUI
- Blocks/allows the `/islandselector slots` command
- Defaults to `true` for backward compatibility
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-config-toggle/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add slotsEnabled config field to Settings.java</name>
  <files>src/main/java/world/bentobox/islandselector/Settings.java</files>
  <action>
Add a new boolean config field `slotsEnabled` with default value `true` in the Slot Settings section.

Location: After line 60 (after `defaultSlotIcon` field), before the Relocation Settings section.

Add these lines:
```java
@ConfigComment("")
@ConfigComment("Enable the multi-slot island system")
@ConfigComment("When disabled:")
@ConfigComment("  - /islandselector slots command shows disabled message")
@ConfigComment("  - Slots button is hidden from the main grid GUI")
@ConfigComment("  - Existing slot data is preserved but inaccessible")
@ConfigEntry(path = "slots.enabled")
private boolean slotsEnabled = true;
```

Then add getter and setter methods in the slots getter/setter section (search for `getDefaultSlots` to find the area - add after the existing slot-related getters):
```java
public boolean isSlotsEnabled() {
    return slotsEnabled;
}

public void setSlotsEnabled(boolean slotsEnabled) {
    this.slotsEnabled = slotsEnabled;
}
```

IMPORTANT: Default MUST be `true` for backward compatibility - existing servers should continue to have slots enabled after update.
  </action>
  <verify>
Run `mvn clean compile -q` - should compile without errors.
Grep for `slotsEnabled` in Settings.java - should find field, getter, and setter.
  </verify>
  <done>
Settings.java contains slotsEnabled field with @ConfigEntry annotation, getter isSlotsEnabled(), and setter setSlotsEnabled().
  </done>
</task>

<task type="auto">
  <name>Task 2: Add config check to SlotsCommand and GUI</name>
  <files>
    src/main/java/world/bentobox/islandselector/commands/SlotsCommand.java
    src/main/java/world/bentobox/islandselector/gui/MainGridGUI.java
    src/main/java/world/bentobox/islandselector/gui/SharedGridGUIListener.java
  </files>
  <action>
**SlotsCommand.java** - Add config check BEFORE the existing FAWE check in execute() method.

At line 31 (before the FAWE check), insert:
```java
// Check if slot system is enabled in config
if (!addon.getSettings().isSlotsEnabled()) {
    user.sendMessage("&cThe slot system is disabled on this server.");
    return false;
}
```

The complete execute() method should now be:
```java
@Override
public boolean execute(User user, String label, List<String> args) {
    IslandSelector addon = (IslandSelector) getAddon();

    // Check if slot system is enabled in config
    if (!addon.getSettings().isSlotsEnabled()) {
        user.sendMessage("&cThe slot system is disabled on this server.");
        return false;
    }

    // Check if FAWE is available
    if (!addon.isSchematicOperationsAvailable()) {
        user.sendMessage("&cThis feature requires FastAsyncWorldEdit (FAWE) to be installed.");
        return false;
    }

    // Open the slot selection GUI
    new SlotSelectionGUI(addon, user.getPlayer()).open();
    return true;
}
```

**MainGridGUI.java** - Modify the slot button conditional at line 723.

Change from:
```java
if (addon.isSchematicOperationsAvailable()) {
```

To:
```java
if (addon.getSettings().isSlotsEnabled() && addon.isSchematicOperationsAvailable()) {
```

**SharedGridGUIListener.java** - Modify the slot click handler at line 85.

Change from:
```java
if (gui.getAddon().isSchematicOperationsAvailable()) {
```

To:
```java
if (gui.getAddon().getSettings().isSlotsEnabled() && gui.getAddon().isSchematicOperationsAvailable()) {
```

IMPORTANT: Do NOT replace the FAWE check - combine with AND (&&). Both conditions must be true.
  </action>
  <verify>
Run `mvn clean package -q` - should compile and package without errors.
Grep for `isSlotsEnabled` in SlotsCommand.java, MainGridGUI.java, SharedGridGUIListener.java - each file should contain the check.
  </verify>
  <done>
All three files contain isSlotsEnabled() checks:
- SlotsCommand shows disabled message when slots disabled
- MainGridGUI hides button when slots disabled
- SharedGridGUIListener ignores click when slots disabled
  </done>
</task>

</tasks>

<verification>
1. `mvn clean package -q` completes without errors
2. JAR file created at `target/IslandSelector-1.0.0.jar`
3. All four files contain `isSlotsEnabled` references
4. Config toggle uses correct path `slots.enabled` (grep for `path = "slots.enabled"`)
5. Default value is `true` (grep for `slotsEnabled = true`)
</verification>

<success_criteria>
- [ ] Settings.java has slotsEnabled field with @ConfigEntry(path = "slots.enabled")
- [ ] Settings.java has isSlotsEnabled() getter returning the field
- [ ] SlotsCommand.execute() checks isSlotsEnabled() before FAWE check
- [ ] SlotsCommand shows "&cThe slot system is disabled on this server." when disabled
- [ ] MainGridGUI only renders slot button when isSlotsEnabled() AND isSchematicOperationsAvailable()
- [ ] SharedGridGUIListener only opens SlotSelectionGUI when isSlotsEnabled() AND isSchematicOperationsAvailable()
- [ ] Build succeeds: `mvn clean package -q`
</success_criteria>

<output>
After completion, create `.planning/phases/05-config-toggle/05-01-SUMMARY.md`
</output>
